[Definition]

# Ban/Unban 专用日志文件
logtarget = /var/log/fail2ban/ban-actions.log

# 改进的 actioncheck：确保目录和文件都存在
actioncheck = if [ ! -d /var/log/fail2ban ]; then mkdir -p /var/log/fail2ban && chmod 755 /var/log/fail2ban; fi && touch "<logtarget>" && chmod 644 "<logtarget>"

# 记录 Ban 操作
actionban = echo "$(date '+%%Y-%%m-%%d %%H:%%M:%%S') - BAN - IP:<ip> - Jail:<name> - Host:$(hostname -s)" >> "<logtarget>"

# 记录 Unban 操作
actionunban =
#actionunban = echo "$(date '+%%Y-%%m-%%d %%H:%%M:%%S') - UNBAN - IP:<ip> - Jail:<name> - Host:$(hostname -s)" >> "<logtarget>"

actionstart =
actionstop =

[Init]
logtarget = /var/log/fail2ban/ban-actions.log