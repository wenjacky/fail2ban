[Definition]

# Log file for SSH login monitoring
logtarget = /var/log/fail2ban/ssh-login-monitor.log

# Action to initialize logging
actionstart = mkdir -p /var/log/fail2ban
              touch "<logtarget>"
              echo "$(date '+%%Y-%%m-%%d %%H:%%M:%%S') [INFO] SSH Login Monitor started" >> "<logtarget>"

# Action to stop logging
actionstop = echo "$(date '+%%Y-%%m-%%d %%H:%%M:%%S') [INFO] SSH Login Monitor stopped" >> "<logtarget>"

# Check if logging is available
actioncheck = test -w /var/log/fail2ban

# 关键：使用actionban来记录（因为fail2ban触发的是actionban）
actionban = echo "$(date '+%%Y-%%m-%%d %%H:%%M:%%S') [SSH_LOGIN] IP: <ip>, User: <F-USER>, KeyType: <F-KEYTYPE>, Port: <F-PORT>" >> "<logtarget>"
            logger -t fail2ban-ssh-monitor "SSH login: <F-USER> from <ip>"

# 空操作
actionunban =

[Init]
logtarget = /var/log/fail2ban/ssh-login-monitor.log